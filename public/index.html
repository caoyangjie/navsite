<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>曹操直达</title>
  
  <!-- 基础路径配置 -->
  <script>
    // 自动检测基础路径（兼容直接访问HTML文件的场景）
    window.BASE_PATH = (function() {
      const pathname = window.location.pathname || '';
      
      // 根目录或空路径
      if (!pathname || pathname === '/' || pathname === '') {
        return '';
      }
      
      // 如果包含文件扩展名（例如其他HTML文件），只取所在目录
      const hasExtension = /\.[^/.]+$/.test(pathname);
      if (hasExtension) {
        const dir = pathname.substring(0, pathname.lastIndexOf('/'));
        return dir || '';
      }
      
      // 目录路径，去掉末尾的斜杠
      return pathname.endsWith('/') ? pathname.slice(0, -1) : pathname;
    })();
    
    // 设置基础路径辅助函数
    window.getBasePath = function(path) {
      if (!path) return window.BASE_PATH || '';
      if (path.startsWith('http://') || path.startsWith('https://') || path.startsWith('//')) {
        return path;
      }
      const base = window.BASE_PATH || '';
      const cleanPath = path.startsWith('/') ? path : '/' + path;
      return base + cleanPath;
    };
  </script>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="" id="manifest-link">
  
  <!-- PWA Meta Tags -->
  <meta name="application-name" content="曹操直达">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="曹操直达">
  <meta name="description" content="基于飞书多维表格的个人网站导航工具，支持分类管理、搜索功能、暗黑模式等特性">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="msapplication-config" content="browserconfig.xml">
  <meta name="msapplication-TileColor" content="#ff0066">
  <meta name="theme-color" content="#ff0066">
  
  <!-- Icons for various devices -->
  <link rel="icon" type="image/x-icon" href="img/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="img/icons/icon-72x72.png">
  <link rel="icon" type="image/png" sizes="16x16" href="img/icons/icon-72x72.png">
  <link rel="apple-touch-icon" sizes="180x180" href="img/icons/icon-192x192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="img/icons/icon-152x152.png">
  <link rel="apple-touch-icon" sizes="144x144" href="img/icons/icon-144x144.png">
  <link rel="apple-touch-icon" sizes="120x120" href="img/icons/icon-128x128.png">
  <link rel="apple-touch-icon" sizes="114x114" href="img/icons/icon-128x128.png">
  <link rel="apple-touch-icon" sizes="76x76" href="img/icons/icon-72x72.png">
  <link rel="apple-touch-icon" sizes="72x72" href="img/icons/icon-72x72.png">
  <link rel="apple-touch-icon" sizes="60x60" href="img/icons/icon-72x72.png">
  <link rel="apple-touch-icon" sizes="57x57" href="img/icons/icon-72x72.png">
  
  <!-- Microsoft Tiles -->
  <meta name="msapplication-TileImage" content="img/icons/icon-144x144.png">
  <meta name="msapplication-square70x70logo" content="img/icons/icon-72x72.png">
  <meta name="msapplication-square150x150logo" content="img/icons/icon-152x152.png">
  <meta name="msapplication-wide310x150logo" content="img/icons/icon-384x384.png">
  <meta name="msapplication-square310x310logo" content="img/icons/icon-384x384.png">
  
  <!-- Stylesheets -->
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/detail.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
  <script defer src="js/modules/core/layout-components.js"></script>
</head>

<body data-page="index">
  <app-top-nav></app-top-nav>

  <div class="container">
    <app-sidebar></app-sidebar>

    <!-- 主内容区 - 工具列表视图 -->
    <main class="main-content" id="main-content">
      <!-- 搜索区域 -->
      <header class="search-section">
        <div class="search-container">
          <input type="text" 
                 class="search-input" 
                 id="main-search-input"
                 placeholder="百度一下"
                 autocomplete="off">
          <button class="search-button" id="main-search-button" title="搜索">
            <i class="bi bi-search"></i>
          </button>
        </div>
        <div class="search-engine-selector">
          <div class="search-engines" id="search-engines">
            <span class="search-engine-item active" data-engine="baidu">百度</span>
            <span class="search-engine-item" data-engine="bing">Bing</span>
            <span class="search-engine-item" data-engine="google">Google</span>
            <span class="search-engine-item" data-engine="perplexity">Perplexity</span>
            <span class="search-engine-item" data-engine="you">YOU</span>
            <span class="search-engine-item" data-engine="360">360</span>
            <span class="search-engine-item" data-engine="sougou">搜狗</span>
            <span class="search-engine-item" data-engine="shenma">神马</span>
          </div>
        </div>
      </header>

      <!-- 分类标签页 -->
      <div class="category-tabs" id="category-tabs">
        <!-- 动态生成的分类标签 -->
      </div>

      <!-- 工具图标列表 -->
      <div class="tools-container">
        <div id="tools-grid" class="tools-grid">
          <!-- 动态生成的工具图标 -->
        </div>
      </div>
    </main>

    <!-- 详情页视图 -->
    <div class="detail-view-container" id="detail-view-container" style="display: none;">
      <button class="back-to-list-btn" id="back-to-list-btn" title="返回列表">
        <i class="bi bi-arrow-left"></i>
        <span>返回列表</span>
      </button>
      <detail-main></detail-main>
    </div>
  </div>

  <!-- 添加链接按钮 -->
  <button id="add-link-btn" class="add-link-btn" title="添加网站">
    <i class="bi bi-plus"></i>
  </button>

  <app-floating-actions></app-floating-actions>

<!-- 添加链接模态框 -->
<div id="add-link-modal" class="modal">
  <div class="modal-overlay"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h2>添加网站</h2>
      <button id="close-modal-btn" class="close-modal-btn" aria-label="关闭">
        <i class="bi bi-x"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <form id="add-link-form">
        <div class="form-group">
          <label for="site-url">网站网址 *</label>
          <input type="url" id="site-url" name="site-url" value="https://" placeholder="请输入完整网址，包含http://或https://">
          <div class="error-message" id="url-error"></div>
        </div>
        <div class="form-group">
          <label for="site-name">网站名称 *</label>
          <input type="text" id="site-name" name="site-name" placeholder="请输入网站名称" maxlength="50">
          <div class="error-message" id="name-error"></div>
        </div>        
        <div class="form-group">
          <label for="site-category">分类 *</label>
          <select id="site-category" name="site-category">
            <!-- 动态生成的分类选项 -->
          </select>
          <div id="custom-category-container" style="display: none; margin-top: 10px;">
            <input type="text" id="custom-category" name="custom-category" placeholder="请输入自定义分类名称" maxlength="20">
          </div>
          <div class="error-message" id="category-error"></div>
        </div>
        
        <div class="form-group">
          <label for="site-sort">排序 (可选)</label>
          <input type="number" id="site-sort" name="site-sort" placeholder="数字越小，排序越靠前" min="0" max="999" value="200">
        </div>
        
        <div class="form-group" id="site-table-group" style="display: none;">
          <label for="site-table">存储表格 *</label>
          <select id="site-table" name="site-table">
            <option value="tbl3I3RtxgtiC7eF">默认表格</option>
            <!-- 动态生成的表格选项 -->
          </select>
          <div class="error-message" id="table-error"></div>
        </div>
      </form>
    </div>
    
    <div class="modal-footer">
      <button id="cancel-add-btn" class="cancel-btn">取消</button>
      <button id="save-link-btn" class="save-btn">保存</button>
    </div>
  </div>
</div>

<!-- 编辑链接模态框 -->
<div id="edit-link-modal" class="modal">
  <div class="modal-overlay"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h2>编辑网站</h2>
      <button id="close-edit-modal-btn" class="close-modal-btn" aria-label="关闭">
        <i class="bi bi-x"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <form id="edit-link-form">
        <div class="form-group">
          <label for="edit-site-url">网站网址 *</label>
          <input type="url" id="edit-site-url" name="edit-site-url" placeholder="请输入完整网址，包含http://或https://">
          <div class="error-message" id="edit-url-error"></div>
        </div>
        <div class="form-group">
          <label for="edit-site-name">网站名称 *</label>
          <input type="text" id="edit-site-name" name="edit-site-name" placeholder="请输入网站名称" maxlength="50">
          <div class="error-message" id="edit-name-error"></div>
        </div>        
        <div class="form-group">
          <label for="edit-site-category">分类 *</label>
          <select id="edit-site-category" name="edit-site-category">
            <!-- 动态生成的分类选项 -->
          </select>
          <div id="edit-custom-category-container" style="display: none; margin-top: 10px;">
            <input type="text" id="edit-custom-category" name="edit-custom-category" placeholder="请输入自定义分类名称" maxlength="20">
          </div>
          <div class="error-message" id="edit-category-error"></div>
        </div>
        
        <div class="form-group">
          <label for="edit-site-sort">排序 (可选)</label>
          <input type="number" id="edit-site-sort" name="edit-site-sort" placeholder="数字越小，排序越靠前" min="0" max="999" value="200">
        </div>
      </form>
    </div>
    
    <div class="modal-footer">
      <button id="cancel-edit-btn" class="cancel-btn">取消</button>
      <button id="save-edit-btn" class="save-btn">保存</button>
    </div>
  </div>
</div>

<!-- 删除确认模态框 -->
<div id="delete-link-modal" class="modal">
  <div class="modal-overlay"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h2>确认删除</h2>
      <button id="close-delete-modal-btn" class="close-modal-btn" aria-label="关闭">
        <i class="bi bi-x"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="delete-confirmation">
        <div class="delete-icon">
          <i class="bi bi-exclamation-triangle"></i>
        </div>
        <p>确定要删除网站 <span id="delete-site-name" class="site-name-highlight"></span> 吗？</p>
        <p class="delete-warning">此操作不可撤销。</p>
      </div>
    </div>
    
    <div class="modal-footer">
      <button id="cancel-delete-btn" class="cancel-btn">取消</button>
      <button id="confirm-delete-btn" class="delete-btn">确认删除</button>
    </div>
  </div>
</div>

<!-- 登录验证模态框 -->
<div id="login-modal" class="modal">
  <div class="modal-overlay"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h2>身份验证</h2>
      <button id="close-login-modal-btn" class="close-modal-btn" aria-label="关闭">
        <i class="bi bi-x"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <form id="login-form">
        <div class="form-group">
          <label for="login-password">请输入密码 *</label>
          <input type="password" id="login-password" name="login-password" placeholder="请输入管理员密码" autocomplete="current-password">
          <div class="error-message" id="login-error"></div>
        </div>
      </form>
    </div>
    
    <div class="modal-footer">
      <button id="cancel-login-btn" class="cancel-btn">取消</button>
      <button id="submit-login-btn" class="save-btn">登录</button>
    </div>
  </div>
</div>

<!-- 管理员审核模态框 -->
<div id="admin-review-modal" class="modal">
  <div class="modal-overlay"></div>
  <div class="modal-content admin-review-modal-content">
    <div class="modal-header">
      <h2>待审核链接管理</h2>
      <button id="close-admin-review-modal-btn" class="close-modal-btn" aria-label="关闭">
        <i class="bi bi-x"></i>
      </button>
    </div>
    
    <div class="modal-body admin-review-modal-body">
      <div id="admin-pending-links-container">
        <div class="loading-state">
          <i class="bi bi-hourglass-split"></i>
          <p>加载中...</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 多维表格管理模态框 -->
<div id="bitable-manage-modal" class="modal">
  <div class="modal-overlay"></div>
  <div class="modal-content admin-review-modal-content">
    <div class="modal-header">
      <h2>多维表格管理</h2>
      <button id="close-bitable-manage-modal-btn" class="close-modal-btn" aria-label="关闭">
        <i class="bi bi-x"></i>
      </button>
    </div>
    
    <div class="modal-body admin-review-modal-body">
      <div class="bitable-manage-toolbar">
        <button id="create-bitable-btn" class="save-btn">
          <i class="bi bi-plus-circle"></i>
          <span>新建表格</span>
        </button>
      </div>
      
      <div id="bitable-list-container">
        <div class="loading-state">
          <i class="bi bi-hourglass-split"></i>
          <p>加载中...</p>
        </div>
      </div>
      
      <div class="pagination" id="bitable-pagination" style="display: none;">
        <button class="pagination-btn" id="bitable-prev-btn" disabled>
          <i class="bi bi-chevron-left"></i>
          <span>上一页</span>
        </button>
        <span class="pagination-info" id="bitable-pagination-info"></span>
        <button class="pagination-btn" id="bitable-next-btn" disabled>
          <span>下一页</span>
          <i class="bi bi-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- 创建多维表格模态框 -->
<div id="create-bitable-modal" class="modal">
  <div class="modal-overlay"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h2>创建多维表格</h2>
      <button id="close-create-bitable-modal-btn" class="close-modal-btn" aria-label="关闭">
        <i class="bi bi-x"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <form id="create-bitable-form">
        <div class="form-group">
          <label for="bitable-name">表格名称 *</label>
          <input type="text" id="bitable-name" name="bitable-name" placeholder="请输入表格名称" maxlength="100" required>
          <div class="error-message" id="bitable-name-error"></div>
        </div>
        
        <div class="form-group">
          <label for="bitable-description">描述 (可选)</label>
          <textarea id="bitable-description" name="bitable-description" placeholder="请输入表格描述" rows="3" maxlength="500"></textarea>
          <div class="error-message" id="bitable-description-error"></div>
        </div>
      </form>
    </div>
    
    <div class="modal-footer">
      <button id="cancel-create-bitable-btn" class="cancel-btn">取消</button>
      <button id="submit-create-bitable-btn" class="save-btn">创建</button>
    </div>
  </div>
</div>

  <script src="js/app.js"></script>
  <script src="js/modules/detail-page.js"></script>
</body>
</html>