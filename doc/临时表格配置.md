# 临时表格配置说明

## 概述

系统现在支持两个多维表格：
1. **正常表格** (`TABLE_ID`) - 用于提供导航数据来源
2. **临时表格** (`TEMP_TABLE_ID`) - 用于存储游客申请添加的导航数据

## 功能说明

### 游客申请流程
- 游客（未登录用户）可以申请添加导航链接
- 申请的数据会存储到临时表格中
- 申请提交后会显示"申请已提交，等待管理员审核"的提示

### 管理员审核流程
- 管理员登录后，可以在首页看到"审核管理"按钮（位于登录按钮旁边）
- 点击打开审核管理模态框
- 可以查看所有待审核的链接（支持分页）
- 可以同意或拒绝申请：
  - **同意**：将临时表格中的数据同步到正常表格，然后删除临时表格中的记录
  - **拒绝**：直接删除临时表格中的记录

### 管理员直接添加
- 管理员（已登录用户）添加链接时，数据直接存储到正常表格
- 无需审核，立即生效

## 配置步骤

### 1. 创建临时多维表格

在飞书中创建一个新的多维表格，用于存储游客申请的数据。

**表格字段设置**（必须严格按照以下格式）：

| 字段名称 | 字段类型 | 是否必填 | 说明 |
|---|---|---|---|
| 站点名称 | 单行文本 | 是 | 显示的网站名称 |
| 网址 | 链接 | 是 | 网站链接地址 |
| 分类 | 单选 | 是 | 网站分类（如：工具、设计） |
| 排序 | 数字 | 否 | 显示顺序，数字越小越靠前 |

### 2. 获取临时表格ID

1. 复制临时多维表格的链接
2. 从链接中提取 `table_id`
   - 链接格式：`https://xxx.feishu.cn/base/APP_TOKEN?table=TABLE_ID`
   - 其中 `TABLE_ID` 就是临时表格的ID

### 3. 配置环境变量

在 `.env` 文件中添加临时表格相关配置：

**如果两个表格在同一个飞书应用中**（使用相同的APP_TOKEN）：
```env
# 正常表格配置（已存在）
APP_ID=your_app_id
APP_SECRET=your_app_secret
APP_TOKEN=your_app_token
TABLE_ID=your_table_id

# 临时表格配置（新增）
TEMP_TABLE_ID=your_temp_table_id
```

**如果两个表格在不同的飞书应用中**（使用不同的APP_TOKEN）：
```env
# 正常表格配置（已存在）
APP_ID=your_app_id
APP_SECRET=your_app_secret
APP_TOKEN=your_app_token
TABLE_ID=your_table_id

# 临时表格配置（新增）
TEMP_APP_ID=your_temp_app_id          # 如果与正常表格相同，可以不设置
TEMP_APP_SECRET=your_temp_app_secret  # 如果与正常表格相同，可以不设置
TEMP_APP_TOKEN=your_temp_app_token    # 如果与正常表格相同，可以不设置
TEMP_TABLE_ID=your_temp_table_id
```

**注意**：
- 如果 `TEMP_APP_ID`、`TEMP_APP_SECRET`、`TEMP_APP_TOKEN` 未设置，系统会自动使用正常表格的配置
- 如果临时表格在不同的应用中，必须设置 `TEMP_APP_TOKEN`
- 如果临时表格应用需要不同的认证信息，需要设置 `TEMP_APP_ID` 和 `TEMP_APP_SECRET`

### 4. 确保应用权限

确保飞书应用对两个表格都有读写权限：
- 正常表格：需要读写权限
- 临时表格：需要读写权限

## API接口说明

### 获取待审核链接列表
```
GET /api/pending-links?page_token={token}&page_size={size}
```
- 需要管理员登录
- 支持分页查询
- 返回待审核的链接列表

### 同意申请
```
POST /api/pending-links/:id/approve
```
- 需要管理员登录
- 将临时表格数据同步到正常表格
- 删除临时表格中的记录

### 拒绝申请
```
POST /api/pending-links/:id/reject
```
- 需要管理员登录
- 删除临时表格中的记录

## 注意事项

1. **临时表格必须配置**：如果不配置 `TEMP_TABLE_ID`，游客申请功能将无法使用
2. **字段名称必须一致**：临时表格的字段名称必须与正常表格一致
3. **权限设置**：确保应用对两个表格都有相应的权限
4. **数据清理**：建议定期清理临时表格中已处理的记录（系统会自动删除，但建议定期检查）

## 故障排查

### 游客申请失败
- 检查 `TEMP_TABLE_ID` 是否已配置
- 检查临时表格是否存在
- 检查应用是否有临时表格的写入权限

### 管理员审核页面无法访问
- 检查是否已登录
- 检查网络连接
- 查看浏览器控制台的错误信息

### 同意/拒绝操作失败
- 检查应用是否有两个表格的读写权限
- 检查表格字段名称是否正确
- 查看服务器日志获取详细错误信息

